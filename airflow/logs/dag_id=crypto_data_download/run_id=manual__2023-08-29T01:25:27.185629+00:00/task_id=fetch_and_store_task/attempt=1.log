[2023-08-29T01:25:31.409+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: crypto_data_download.fetch_and_store_task manual__2023-08-29T01:25:27.185629+00:00 [queued]>
[2023-08-29T01:25:31.418+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: crypto_data_download.fetch_and_store_task manual__2023-08-29T01:25:27.185629+00:00 [queued]>
[2023-08-29T01:25:31.419+0000] {taskinstance.py:1361} INFO - Starting attempt 1 of 2
[2023-08-29T01:25:31.434+0000] {taskinstance.py:1382} INFO - Executing <Task(PythonOperator): fetch_and_store_task> on 2023-08-29 01:25:27.185629+00:00
[2023-08-29T01:25:31.442+0000] {standard_task_runner.py:57} INFO - Started process 1208 to run task
[2023-08-29T01:25:31.447+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'crypto_data_download', 'fetch_and_store_task', 'manual__2023-08-29T01:25:27.185629+00:00', '--job-id', '134', '--raw', '--subdir', 'DAGS_FOLDER/coin_data_dag.py', '--cfg-path', '/tmp/tmpgsrp7mui']
[2023-08-29T01:25:31.452+0000] {standard_task_runner.py:85} INFO - Job 134: Subtask fetch_and_store_task
[2023-08-29T01:25:31.513+0000] {task_command.py:415} INFO - Running <TaskInstance: crypto_data_download.fetch_and_store_task manual__2023-08-29T01:25:27.185629+00:00 [running]> on host 6c9aee5df47e
[2023-08-29T01:25:31.600+0000] {taskinstance.py:1660} INFO - Exporting env vars: AIRFLOW_CTX_DAG_OWNER='NicoB' AIRFLOW_CTX_DAG_ID='crypto_data_download' AIRFLOW_CTX_TASK_ID='fetch_and_store_task' AIRFLOW_CTX_EXECUTION_DATE='2023-08-29T01:25:27.185629+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2023-08-29T01:25:27.185629+00:00'
[2023-08-29T01:25:31.981+0000] {base.py:73} INFO - Using connection ID 'postgres_connection' for task execution.
[2023-08-29T01:25:31.986+0000] {sql.py:418} INFO - Running statement: 
        INSERT INTO coin_data (coin_id, price_usd, date, json_response)
        VALUES (%s, %s, %s, %s);
    , parameters: ('bitcoin', 29233.136365580438, '01-08-2023', '{"id": "bitcoin", "symbol": "btc", "name": "Bitcoin", "localization": {"en": "Bitcoin", "de": "Bitcoin", "es": "Bitcoin", "fr": "Bitcoin", "it": "Bitcoin", "pl": "Bitcoin", "ro": "Bitcoin", "hu": "Bitcoin", "nl": "Bitcoin", "pt": "Bitcoin", "sv": "Bitcoin", "vi": "Bitcoin", "tr": "Bitcoin", "ru": "\\u0411\\u0438\\u0442\\u043a\\u043e\\u0438\\u043d", "ja": "\\u30d3\\u30c3\\u30c8\\u30b3\\u30a4\\u30f3", "zh": "\\u6bd4\\u7279\\u5e01", "zh-tw": "\\u6bd4\\u7279\\u5e63", "ko": "\\ube44\\ud2b8\\ucf54\\uc778", "ar": "\\u0628\\u064a\\u062a\\u0643\\u0648\\u064a\\u0646", "th": "\\u0e1a\\u0e34\\u0e15\\u0e04\\u0e2d\\u0e22\\u0e19\\u0e4c", "id": "Bitcoin", "cs": "Bitcoin", "da": "Bitcoin", "el": "Bitcoin", "hi": "Bitcoin", "no": "Bitcoin", "sk": "Bitcoin", "uk": "Bitcoin", "he": "Bitcoin", "fi": "Bitcoin", "bg": "Bitcoin", "hr": "Bitcoin", "lt": "Bitcoin", "sl": "Bitcoin"}, "image": {"thumb": "https://assets.coingecko.com/coins/images/1/thumb/bitcoin.png?1547033579", "small": "https://assets.coingecko.com/coins/images/1/small/bitcoin.png?1547033579"}, "market_data": {"current_price": {"aed": 107375.2100246405, "ars": 8046675.112912388, "aud": 43521.12409562149, "bch": 117.73340855183662, "bdt": 3174256.4334160984, "bhd": 11018.69992459639, "bmd": 29233.136365580438, "bnb": 121.19299058974822, "brl": 138158.7257773699, "btc": 1.0, "cad": 38569.030795292216, "chf": 25482.846534376513, "clp": 24565660.79814665, "cny": 207751.13020926996, "czk": 634780.0162967591, "dkk": 198079.96093858208, "dot": 5718.449963449061, "eos": 39151.7006590528, "eth": 15.739420108073025, "eur": 26581.63243094954, "gbp": 22777.407463151078, "hkd": 227958.53572197733, "huf": 10294882.44008514, "idr": 441514808.34361553, "ils": 107125.35440812413, "inr": 2404289.239653529, "jpy": 4161301.881876737, "krw": 37359371.79776268, "kwd": 8978.636270187997, "lkr": 9360918.169839513, "ltc": 316.6523510492546, "mmk": 61426278.280361876, "mxn": 489748.5801598414, "myr": 132440.72430426246, "ngn": 22228876.89238737, "nok": 296004.7995715029, "nzd": 47095.898176086506, "php": 1600046.5442999527, "pkr": 8380244.229615432, "pln": 117120.74839424324, "rub": 2679217.1233042646, "sar": 109674.92239624803, "sek": 307637.833856822, "sgd": 38874.37090463062, "thb": 1001585.7181575209, "try": 787689.782684201, "twd": 918338.5741955253, "uah": 1080280.0349956555, "usd": 29233.136365580438, "vef": 2927.1139442855665, "vnd": 692471105.999501, "xag": 1181.6861016726718, "xau": 14.882589723716988, "xdr": 21780.323647993864, "xlm": 193984.51876533809, "xrp": 41801.30648224164, "yfi": 4.3505370451195065, "zar": 522399.07016655843, "bits": 1000033.6742708246, "link": 3870.8279946729654, "sats": 100003367.42708246}, "market_cap": {"aed": 2087526635035.9453, "ars": 156446639425910.03, "aud": 846169317950.978, "bch": 2287603249.8663096, "bdt": 61712054855768.41, "bhd": 214219181231.72995, "bmd": 568333703606.0996, "bnb": 2356176357.3482957, "brl": 2686115583353.5107, "btc": 19444562.0, "cad": 749831071852.7078, "chf": 495416489433.4364, "clp": 477591347310251.25, "cny": 4038977131417.473, "czk": 12342218306028.164, "dkk": 3851086009005.294, "dot": 111185805537.8474, "eos": 761028290877.7799, "eth": 306028237.0869346, "eur": 516814821707.91003, "gbp": 442868923531.7199, "hkd": 4431894637405.544, "huf": 200145143852409.94, "idr": 8583959318393554, "ils": 2082669086871.2114, "inr": 46740986270362.05, "jpy": 80907701878512.56, "krw": 726319265667960.9, "kwd": 174557445391.87384, "lkr": 181989548643933.1, "ltc": 6163709693.841419, "mmk": 1194214120484224.2, "mxn": 9521741815137.725, "myr": 2574835844187.4307, "ngn": 432160948222077.4, "nok": 5756483288716.216, "nzd": 915781103303.4678, "php": 31107178069843.574, "pkr": 162923853964187.0, "pln": 2276322544704.2495, "rub": 52087787345501.37, "sar": 2132236310831.216, "sek": 5981797480509.751, "sgd": 755775842392.4275, "thb": 19465429348508.918, "try": 15315968713444.127, "twd": 17854317533860.062, "uah": 21002178676376.79, "usd": 568333703606.0996, "vef": 56907253742.07873, "vnd": 13462622121391196, "xag": 22973656684.139755, "xau": 289333005.16883034, "xdr": 423440435873.9472, "xlm": 3765161443465.8076, "xrp": 812537037998.3958, "yfi": 84612755.04039879, "zar": 10156236950181.717, "bits": 19450622178417.207, "link": 75274775916.75539, "sats": 1945062217841720.5}, "total_volume": {"aed": 24395793755.45387, "ars": 1828215529699.1357, "aud": 9888058586.322195, "bch": 26749190.548713073, "bdt": 721195378884.6709, "bhd": 2503463609.0770116, "bmd": 6641808341.386258, "bnb": 27535212.293002058, "brl": 31389850402.22564, "btc": 227209.01091063037, "cad": 8762936253.291376, "chf": 5789737391.078162, "clp": 5581351544369.475, "cny": 47201339339.72961, "czk": 144222883048.1976, "dkk": 45004036527.95729, "dot": 1299239609.1907256, "eos": 8895319638.809875, "eth": 3576017.655275162, "eur": 6039383041.205837, "gbp": 5175057954.507874, "hkd": 51792489355.71282, "huf": 2339011292153.2476, "idr": 100312764946935.42, "ils": 24339026219.560093, "inr": 546257785252.1493, "jpy": 945453447226.3242, "krw": 8488100083831.148, "kwd": 2039958372.1650312, "lkr": 2126813339696.1895, "ltc": 71943844.82791194, "mmk": 13956133969367.21, "mxn": 111271543504.91208, "myr": 30090712690.65051, "ngn": 5050431062790.112, "nok": 67252693050.04111, "nzd": 10700252119.348618, "php": 363532751041.0522, "pkr": 1904002886691.5828, "pln": 26609993327.646854, "rub": 608721774338.9005, "sar": 24918291534.054054, "sek": 69895734261.41237, "sgd": 8832309941.417135, "thb": 227561637392.57687, "try": 178964189939.48676, "twd": 208647773062.4268, "uah": 245441093208.0199, "usd": 6641808341.386258, "vef": 665044269.2230054, "vnd": 157330377092609.75, "xag": 268480689.47643775, "xau": 3381344.6265997407, "xdr": 4948519155.599872, "xlm": 44073546496.10617, "xrp": 9497313685.489094, "yfi": 988447.9336882444, "zar": 118689779241.40645, "bits": 227209010910.63037, "link": 879457384.9886625, "sats": 22720901091063.04}}, "community_data": {"facebook_likes": null, "twitter_followers": 5928572, "reddit_average_posts_48h": 12.5, "reddit_average_comments_48h": 592.5, "reddit_subscribers": 5681787, "reddit_accounts_active_48h": "2116.33333333333"}, "developer_data": {"forks": null, "stars": null, "subscribers": null, "total_issues": null, "closed_issues": null, "pull_requests_merged": null, "pull_request_contributors": null, "code_additions_deletions_4_weeks": {"additions": null, "deletions": null}, "commit_count_4_weeks": null}, "public_interest_stats": {"alexa_rank": null, "bing_matches": null}}')
[2023-08-29T01:25:31.989+0000] {taskinstance.py:1943} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 192, in execute
    return_value = self.execute_callable()
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/operators/python.py", line 209, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/opt/airflow/dags/coin_data_dag.py", line 56, in fetch_and_store_crypto_data_for_range
    fetch_and_store_crypto_data_for_date(current_date.strftime('%d-%m-%Y'))
  File "/opt/airflow/dags/coin_data_dag.py", line 51, in fetch_and_store_crypto_data_for_date
    pg_hook.run(insert_query, parameters=values)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/providers/common/sql/hooks/sql.py", line 392, in run
    self._run_command(cur, sql_statement, parameters)
  File "/home/airflow/.local/lib/python3.8/site-packages/airflow/providers/common/sql/hooks/sql.py", line 421, in _run_command
    cur.execute(sql_statement, parameters)
psycopg2.errors.UniqueViolation: duplicate key value violates unique constraint "coin_data_pkey"
DETAIL:  Key (coin_id, date)=(bitcoin, 2023-01-08) already exists.

[2023-08-29T01:25:32.000+0000] {taskinstance.py:1400} INFO - Marking task as UP_FOR_RETRY. dag_id=crypto_data_download, task_id=fetch_and_store_task, execution_date=20230829T012527, start_date=20230829T012531, end_date=20230829T012532
[2023-08-29T01:25:32.015+0000] {standard_task_runner.py:104} ERROR - Failed to execute job 134 for task fetch_and_store_task (duplicate key value violates unique constraint "coin_data_pkey"
DETAIL:  Key (coin_id, date)=(bitcoin, 2023-01-08) already exists.
; 1208)
[2023-08-29T01:25:32.063+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 1
[2023-08-29T01:25:32.085+0000] {taskinstance.py:2784} INFO - 0 downstream tasks scheduled from follow-on schedule check
